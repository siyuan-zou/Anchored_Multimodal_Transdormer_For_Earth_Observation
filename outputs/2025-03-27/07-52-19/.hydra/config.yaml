trainer:
  _target_: pytorch_lightning.Trainer
  val_check_interval: 1.0
  devices: ${machine.devices}
  accelerator: ${machine.accelerator}
  gradient_clip_val: 1
  log_every_n_steps: 1000
  num_nodes: ${machine.num_nodes}
  precision: ${machine.precision}
logger:
  _target_: pytorch_lightning.loggers.WandbLogger
  mode: online
  project: adapt
  save_dir: ${paths.logs}/wandb
  name: 100E_avg_anchor-s2
  log_model: true
seed: 1999
classification_partition: 1.0
max_epochs: 100
projection_method: pooling
pooling_method: avg
anchor: s2
test: true
log: true
checkpoints: true
anchoring: true
contrastive: true
clf: true
load_checkpoint: false
path_cpt: ./misc/checkpoints/adapt_TS/contrastive/last-v9.ckpt
cv: 1
grid: {}
multimodal:
  path_labels: null
  modalities:
  - aerial
  - s2
  - s1-asc
  hyperparams:
    batch_size: 32
    num_workers: 5
    sliding_window: true
  keep_missing: true
  classification_partition: ${classification_partition}
  partition: 1.0
  mono_strict: false
  train_transform:
  - p: 0.0
  - size: 300
  val_transform:
  - p: 0.0
  - size: 300
  test_transform:
  - p: 0.0
  - size: 300
  classes:
  - Abies
  - Acer
  - Alnus
  - Betula
  - Cleared
  - Fagus
  - Fraxinus
  - Larix
  - Picea
  - Pinus
  - Populus
  - Prunus
  - Pseudotsuga
  - Quercus
  - Tilia
  name: PASTIS-HD
  global_batch_size: 2048
  num_classes: 18
  nb_split: 1
  sat_patch_size: 50
  train_dataset:
    _partial_: true
    _target_: data.Pastis.PASTIS
    path: ${data_dir}
    modalities: ${modalities}
    transform: ${dataset.train_transform}
    reference_date: '2018-09-01'
    folds:
    - 1
    - 2
    - 3
    nb_split: ${dataset.nb_split}
  val_dataset:
    _partial_: true
    _target_: data.Pastis.PASTIS
    path: ${data_dir}
    modalities: ${modalities}
    transform: ${dataset.test_transform}
    reference_date: '2018-09-01'
    folds:
    - 4
    nb_split: ${dataset.nb_split}
  test_dataset:
    _partial_: true
    _target_: data.Pastis.PASTIS
    path: ${data_dir}
    modalities: ${modalities}
    transform: ${dataset.test_transform}
    reference_date: '2018-09-01'
    folds:
    - 5
    nb_split: ${dataset.nb_split}
model:
  modalities: ${modalities}
  encoders:
    type:
    - TreeSAT
    aerial:
      patch_size: 40
      in_chans: 3
      embed_dim: 256
      bias: false
      res: true
      gp_norm: 4
    s2:
      in_channels: 10
      n_head: 16
      d_k: 8
      mlp:
      - 256
      - 512
      - 256
      mlp_in:
      - 32
      - 128
      - 256
      dropout: 0.2
      T: 734
      in_norm: true
      positional_encoding: true
      patch_size: 4
    s1-asc:
      in_channels: 3
      n_head: 16
      d_k: 8
      mlp:
      - 256
      - 512
      - 256
      mlp_in:
      - 32
      - 128
      - 256
      dropout: 0.2
      T: 734
      in_norm: false
      positional_encoding: true
      patch_size: 4
    projection: true
    projection_method: ${projection_method}
    embed_dim: 256
    pooling_method: ${pooling_method}
  num_patches: 1024
  embed_dim: 256
  depth: 6
  num_heads: 16
  mlp_ratio: 4.0
  class_token: true
  drop_rate: 0.2
  pos_drop_rate: 0.2
  patch_drop_rate: 0.0
  drop_path_rate: 0.2
  attn_drop_rate: 0.2
  anchor: ${anchor}
  transformer:
    _target_: src.models.modules.attention.Attention
    d_model: 64
    dropout: 0.2
    n_heads: 4
    n_blocks: 1
  supervised_loss:
    max_epochs: ${max_epochs}
    lr: 0.0001
    weight_decay: 0.05
    warmup: 4
    min_lr: 1.0e-08
    sch: true
  contrastive_loss:
    max_epochs: ${max_epochs}
    lr: 0.0001
    weight_decay: 0.0001
    warmup: 4
    min_lr: 1.0e-08
    learnable_scale: true
    sch: true
    modality_dropout: true
    temperature: 0.07
    temperature_max: 1
    temperature_min: 0.07
    ts_augment: true
    cos: false
    gamma: 0.05
    noise_sigma: 0.1
  anchoring_loss:
    max_epochs: ${max_epochs}
    lr: 0.001
    weight_decay: 0.0001
    cos: true
    learnable_scale: false
    warmup: 4
    min_lr: 1.0e-08
    sch: true
    temperature_max: 1
    temperature_min: 0.07
    period: 100
    gamma: 0.05
machine:
  devices: 1
  num_workers: 10
  progress_bar_refresh_rate: 2
  sync_batchnorm: false
  accelerator: gpu
  precision: 32
  num_nodes: 1
  eval_gpu_type: null
  strategy: single_device
paths:
  data: /Data/zou.siyuan/ADAPT/misc/PASTIS-HD
  misc: /Data/zou.siyuan/ADAPT/misc
  logs: /Data/zou.siyuan/ADAPT/logs
